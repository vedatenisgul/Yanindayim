{% extends "base.html" %}

{% block title %}{{ title }} - YanÄ±ndayÄ±m{% endblock %}

{% block content %}
<script>
    document.documentElement.dataset.guideId = "{{ guide.id }}";
    document.documentElement.dataset.helpOptions = '{{ guide.help_options | safe if guide.help_options else "" }}';
</script>
<div class="guide-page">
    <div class="guide-container">
        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-track">
                <div id="progress-bar" class="progress-fill" style="width: 0%"></div>
            </div>
            <span id="progress-text">HazÄ±rlanÄ±yor...</span>
        </div>

        <h1 class="guide-main-title">{{ title }}</h1>

        <!-- Step Container -->
        <div id="steps-wrapper" class="steps-wrapper">
            {% if steps %}
            {% for step in steps %}
            <div class="step-card {{ 'active' if loop.first else '' }}" data-step="{{ loop.index }}"
                data-total="{{ steps|length }}">
                <div class="step-header">
                    <span class="step-badge">ADIM {{ loop.index }}</span>
                    <h2 class="step-title">{{ step.title }}</h2>
                </div>

                {% if step.image_url %}
                <div class="step-image-container">
                    <img src="{{ step.image_url }}" alt="{{ step.title }}" class="step-image">
                </div>
                {% endif %}

                <div class="step-description">
                    {{ step.description }}
                </div>

                <div class="step-actions">
                    {% if not loop.first %}
                    <button onclick="prevStep()" class="nav-button secondary">â† Geri</button>
                    {% else %}
                    <div></div> <!-- Spacer -->
                    {% endif %}

                    <div class="main-actions">
                        <button onclick="showProblem()" class="nav-button secondary danger">Sorun Var</button>
                        {% if loop.last %}
                        <button onclick="finishGuide()" class="nav-button primary success">TamamlandÄ± âœ“</button>
                        {% else %}
                        <button onclick="nextStep()" class="nav-button primary">TamamlandÄ± â†’</button>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
            {% else %}
            <div class="step-card active">
                <p class="empty-state">Bu rehber henÃ¼z aÅŸamalara bÃ¶lÃ¼nmemiÅŸ. LÃ¼tfen daha sonra tekrar kontrol edin.</p>
                <a href="/" class="nav-button primary">Geri DÃ¶n</a>
            </div>
            {% endif %}
        </div>

        <!-- Completion Modal (Hidden by default) -->
        <div id="completion-card" class="step-card" style="display: none; text-align: center;">
            <div class="success-icon">âœ“</div>
            <h2 class="step-title">Tebrikler!</h2>
            <p class="step-description">Bu rehberi baÅŸarÄ±yla tamamladÄ±nÄ±z. ArtÄ±k ne yapmanÄ±z gerektiÄŸini biliyorsunuz.
            </p>
            <div class="step-actions" style="justify-content: center;">
                <a href="/" class="nav-button primary">Ana Sayfaya DÃ¶n</a>
            </div>
            <!-- AI Guidance Modal Moved -->
        </div>

        <!-- AI Guidance Modal -->
        <div id="ai-support-modal" class="support-modal-overlay" style="display: none;">
            <div class="support-modal-card">
                <div class="support-modal-header">
                    <div class="ai-avatar-group">
                        <div class="ai-avatar">ğŸ¤–</div>
                        <h3>YanÄ±ndayÄ±m DesteÄŸi</h3>
                    </div>
                    <button onclick="closeSupportModal()" class="close-modal-btn">Ã—</button>
                </div>
                <div class="support-modal-body">
                    <p id="ai-guidance-text">YÃ¼kleniyor...</p>
                </div>
                <div class="support-modal-footer">
                    <button onclick="closeSupportModal()" class="nav-button primary">AnladÄ±m, TeÅŸekkÃ¼rler</button>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/guide-steps.js"></script>
    {% endblock %}