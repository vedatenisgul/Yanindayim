<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}YanÄ±ndayÄ±m{% endblock %}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="YanÄ±ndayÄ±m">
    <link rel="apple-touch-icon" href="/static/img/icon-192.png">
    <meta name="theme-color" content="#4F46E5">
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="manifest" href="/static/manifest.json">
</head>

<body>
    <nav class="navbar">
        <div class="nav-content">
            <div class="logo-container">
                <a href="/">
                    <img src="/static/img/logo.png" alt="YanÄ±ndayÄ±m Logo" class="logo">
                </a>
            </div>
            <div class="nav-links">
                <button id="pwa-install-btn" class="nav-button primary" style="display: none;">
                    ğŸ“² UygulamayÄ± YÃ¼kle
                </button>

                {% if user %}
                <div class="user-profile-badge">

                    {% if user.role == 'admin' %}
                    <a href="/admin" class="admin-link">Admin</a>
                    {% endif %}
                    <button type="button" class="reading-mode-toggle" data-reading-toggle aria-pressed="false"
                        aria-label="Okuma modunu aÃ§ veya kapat">
                        <span class="reading-mode-icon" aria-hidden="true">
                            <svg viewBox="0 0 24 24" width="16" height="16" focusable="false" aria-hidden="true">
                                <path
                                    d="M3 10v4a1 1 0 0 0 1 1h2l3.5 3.5a1 1 0 0 0 1.7-.7V6.2a1 1 0 0 0-1.7-.7L6 9H4a1 1 0 0 0-1 1Zm13-4a1 1 0 0 0-1 1v10a1 1 0 1 0 2 0V7a1 1 0 0 0-1-1Zm4 2a1 1 0 0 0-1 1v6a1 1 0 1 0 2 0v-6a1 1 0 0 0-1-1Z"
                                    fill="currentColor" />
                            </svg>
                        </span>
                        <span class="reading-mode-label">Okuma Modu</span>
                    </button>
                    <div class="user-avatar text-center">{{ user.name[0] }}</div>
                    <span class="user-profile-name">{{ user.name }}</span>
                    <a href="/logout" class="logout-link">Ã‡Ä±kÄ±ÅŸ Yap</a>
                </div>
                {% else %}
                <a href="/login" class="nav-link">GiriÅŸ Yap</a>
                <a href="/register" class="nav-button primary">KayÄ±t Ol</a>
                {% endif %}
            </div>
        </div>
    </nav>

    <main>
        {% block content %}{% endblock %}
    </main>

    <section class="reading-mode-panel" data-reading-panel hidden aria-label="Okuma modu ayarlarÄ±">
        <div class="reading-mode-header">
            <div>
                <h2 class="reading-mode-title">Okuma Modu</h2>
                <p class="reading-mode-subtitle">
                    TÄ±klayÄ±n veya TAB ile Ã¼zerine gelin, metin yÃ¼ksek sesle okunsun.
                </p>
            </div>
            <button type="button" class="reading-mode-close" data-reading-close
                aria-label="Okuma modunu kapat">Ã—</button>
        </div>
        <div class="reading-mode-body">
            <div class="reading-mode-row reading-mode-row-inline">
                <label class="reading-mode-checkbox-label">
                    <input type="checkbox" id="reading-hover">
                    <span class="reading-mode-hover-text">Hover ile oku (deneysel)</span>
                </label>
            </div>
            <div class="reading-mode-actions">
                <button id="reading-prev" class="reading-mode-btn secondary" type="button">Ã–nceki</button>
                <button id="reading-repeat" class="reading-mode-btn secondary" type="button">Tekrar</button>
                <button id="reading-next" class="reading-mode-btn secondary" type="button">Sonraki</button>
                <button id="reading-pause" class="reading-mode-btn" type="button">Duraklat</button>
                <button id="reading-stop" class="reading-mode-btn danger" type="button">Durdur</button>
            </div>
        </div>
    </section>

    <button type="button" id="reading-stop-floating" class="reading-stop-floating" aria-label="OkumayÄ± durdur">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"
            stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
        <span>OkumayÄ± Durdur</span>
    </button>

    <button type="button" id="takildim-btn" class="takildim-button" aria-label="YardÄ±m LazÄ±m">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
        </svg>
        <span class="takildim-text">YardÄ±m LazÄ±m</span>
    </button>

    <!-- Global Help Modal -->
    <div id="global-help-modal" class="global-help-overlay" style="display: none;">
        <div class="global-help-card">
            <div class="global-help-header">
                <h3>Size NasÄ±l YardÄ±mcÄ± Olabiliriz?</h3>
                <button id="close-help-modal" class="close-modal-btn">Ã—</button>
            </div>
            <p class="global-help-subtitle">LÃ¼tfen yapmak istediÄŸiniz iÅŸlemi seÃ§in:</p>
            <div class="help-options-grid">
                <button class="help-option-card" data-guide-id="1">
                    <span class="option-icon">ğŸ¥</span>
                    <span class="option-text">MHRS Randevu</span>
                </button>
                <button class="help-option-card" data-guide-id="2">
                    <span class="option-icon">ğŸ›ï¸</span>
                    <span class="option-text">e-Devlet Åifresi</span>
                </button>
                <button class="help-option-card" data-guide-id="3">
                    <span class="option-icon">ğŸ›’</span>
                    <span class="option-text">Market AlÄ±ÅŸveriÅŸi</span>
                </button>
                <button class="help-option-card" data-guide-id="4">
                    <span class="option-icon">ğŸ’¬</span>
                    <span class="option-text">WhatsApp</span>
                </button>
                <button class="help-option-card" data-guide-id="5">
                    <span class="option-icon">â¤ï¸</span>
                    <span class="option-text">e-NabÄ±z</span>
                </button>
                <button class="help-option-card" data-guide-id="6">
                    <span class="option-icon">ğŸ”</span>
                    <span class="option-text">Yemek SipariÅŸi</span>
                </button>
            </div>
        </div>
    </div>
    <footer class="site-footer">
        <div class="footer-content">
            <p>&copy; 2026 YanÄ±ndayÄ±m. TÃ¼m haklarÄ± saklÄ±dÄ±r.</p>
        </div>
    </footer>

    {% if user and user.voice_support %}
    <script>
        // Voice support - read text on click
        document.addEventListener('click', function (e) {
            const target = e.target;
            if (target.closest('.feature-card, .guide-content, .hero-title, .hero-subtitle, h1, h2, p')) {
                const text = target.innerText || target.textContent;
                if (text && text.trim() && 'speechSynthesis' in window) {
                    window.speechSynthesis.cancel();
                    const utterance = new SpeechSynthesisUtterance(text.trim());
                    utterance.lang = 'tr-TR';
                    utterance.rate = 0.85;
                    window.speechSynthesis.speak(utterance);
                }
            }
        });
    </script>
    {% endif %}
    <script src="/static/js/reading-mode.js" defer></script>
    <script src="/static/js/global-help.js" defer></script>

    <!-- PWA & Accessibility Scripts -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/static/sw.js')
                    .then(reg => console.log('SW Registered!', reg.scope))
                    .catch(err => console.error('SW Failed:', err));
            });
        }

        let deferredPrompt;
        const installBtn = document.getElementById('pwa-install-btn');

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installBtn.style.display = 'block';
        });

        installBtn.addEventListener('click', (e) => {
            installBtn.style.display = 'none';
            deferredPrompt.prompt();
            deferredPrompt.userChoice.then((choiceResult) => {
                if (choiceResult.outcome === 'accepted') {
                    console.log('User accepted the install prompt');
                }
                deferredPrompt = null;
            });
        });
    </script>

    <script src="/static/js/confetti.browser.min.js"></script>
    <script src="{{ url_for('static', path='/js/voice-nav.js') }}"></script>
    {% block scripts %}{% endblock %}
</body>

</html>